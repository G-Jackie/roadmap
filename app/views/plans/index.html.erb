<% javascript "views/plans/index.js" %>

<h1>
  <%= _('My plans') %>
</h1>

<!-- if the user has projects -->
<p>
<% if @plans.count > 0 %>
    <%= _('The table below lists the plans that you have created, and any that have been shared with you by others.') %><br />
    <%= _('These can be edited, shared, exported or deleted at anytime.')%>
<% else %>
    <strong><%= _("Welcome.") %></strong><br /> 
    <%= _("You are now ready to create your first DMP.") %><br />
    <%= _("Click the 'Create plan' button below to begin.")%>
<% end %>
</p>
    
<div class="content">
  <% if @plans.count > 0 %>
    <table class="dmp_table tablesorter">
      <thead>
        <tr>
          <td colspan="7" class="td-as-th"><%= render(partial: "toolbar") %></td>
        </tr>
        <tr>
          <th class="col-large"><%= _('Project Title') %></th>
          <th class="col-large"><%= _('Template') %></th>
          <th class="col-small"><%= _('Edited') %></th>
          <th class="col-small"><%= _('Role') %></th>
          <th class="col-small"><%= _('Visibility') %></th>
          <th class="col-tiny sorter-false centered"><%= _('Test') %></th>
          <th class="col-large sorter-false"><%= _('Select an Action') %></th>
        </tr>
      </thead>
      <tbody>
        <% @plans.each do |plan| %>
          <tr class="table-data">
            <td><%= plan.title %></td>
            <td><%= plan.template.title %></td>
            <td><%= l(plan.latest_update.to_date, formats: :short) %></td>
            <td><%= display_role(plan.roles.find_by(user: current_user)) %></td>
            <td id="visibility-<%= plan.id %>"><%= raw display_visibility(plan.visibility) %></td>
            <td class="centered">
              <input type="checkbox" id="is_test-<%= plan.id %>"<%= plan.visibility === 'is_test' ? 'checked="true"' : '' %><%= plan.administerable_by?(current_user.id) ? '' : 'disabled="true"' %> />
            </td>
            <td>
              <% if plan.editable_by?(current_user.id) then %>
                <%= link_to _('Edit'), 
                            edit_plan_path(plan), 
                            class: "dmp_table_link" %>

                <% if plan.administerable_by?(current_user.id) then %>
                  <%= link_to _('Share'), 
                              share_plan_path(plan), 
                              class: "dmp_table_link" %>
                <% end %>

                <%= link_to _('Export'), 
                            show_export_plan_path(plan), 
                            class: "dmp_table_link" %>

                <%= link_to _('Duplicate'), 
                            duplicate_plan_path(plan), 
                            class: "dmp_table_link" %>

                <% if plan.owned_by?(current_user.id) then %>
                  <%= link_to _('Delete'), 
                              plan_path(plan), 
                              class: "dmp_table_link",
                              method: :delete, 
                              data: {confirm: _('Are you sure you wish to delete this plan? If the plan is being shared with other users, by deleting it from your list, the plan will be deleted from their plan list as well')} %>
                            
                <% end %>
              <% else %>
                <%= link_to _('View'), 
                            plan_path(plan), 
                            class: "dmp_table_link" %>
                          
                <%= link_to _('Export'), 
                            show_export_plan_path(plan), 
                            class: "dmp_table_link" %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
    
    <div>
      <a href="<%= new_plan_path %>" class="link-as-button"><%= _('Create plan') %></a>
      <a href="<%= new_plan_path %>?test=true" class="left-indent"><%= _('Create test plan') %></a>
    </div>
  <% end %>
</div>

